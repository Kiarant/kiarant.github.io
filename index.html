<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magitrickle + SingBox Руководство</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        :root {
            --primary-color: #1aa6d1;
            --primary-hover: #2239e9;
            --bg-color: #f4f7fa;
            --text-color: #333;
            --container-bg: #fff;
            --highlight-bg: #e8f5e9;
            --highlight-border: #0affe8;
            --code-bg: #2d2d2d;
            --code-text: #f8f8f2;
            --shadow: rgba(0, 0, 0, 0.1);
        }
        body.dark {
            --primary-color: #d1992e;
            --primary-hover: #f18513;
            --bg-color: #1e1e1e;
            --text-color: #ddd;
            --container-bg: #2d2d2d;
            --highlight-bg: #3a3a3a;
            --highlight-border: #ddb72e;
            --code-bg: #1e1e1e;
            --code-text: #f8f8f2;
            --shadow: rgba(0, 0, 0, 0.3);
        }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        h1, h2, h3 {
            color: var(--primary-color);
            font-weight: 600;
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
            margin-top: 40px;
            font-size: 2.5em;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }
        h2 {
            font-size: 1.8em;
            margin-top: 30px;
            text-align: center;
        }
        h3 {
            font-size: 1.4em;
            margin-top: 20px;
        }
        pre {
            background-color: var(--code-bg);
            color: var(--code-text);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Consolas', monospace;
            box-shadow: 0 2px 4px var(--shadow);
        }
        code {
            font-family: 'Consolas', monospace;
            background-color: var(--highlight-bg);
            padding: 2px 4px;
            border-radius: 4px;
        }
        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.3s;
        }
        a:hover {
            color: var(--primary-hover);
            text-decoration: underline;
        }
        img {
            display: block;
            max-width: 100%;
            height: auto;
            margin: 15px auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px var(--shadow);
            transition: transform 0.3s;
        }
        img:hover {
            transform: scale(1.02);
        }
        ul, ol {
            margin: 15px 0;
            padding-left: 25px;
        }
        li {
            margin-bottom: 12px;
        }
        .container {
            background-color: var(--container-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px var(--shadow);
            margin-bottom: 20px;
            transition: background-color 0.3s;
            position: relative;
        }
        .section {
            margin-bottom: 30px;
        }
        .highlight {
            background-color: var(--highlight-bg);
            padding: 10px;
            border-left: 4px solid var(--highlight-border);
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .donate-button {
            display: inline-block;
            padding: 12px 24px;
            background-color: var(--primary-color);
            color: #fff;
            border-radius: 6px;
            text-align: center;
            font-weight: 600;
            transition: background-color 0.3s;
            box-shadow: 0 2px 4px var(--shadow);
        }
        .donate-button:hover {
            background-color: var(--primary-hover);
            text-decoration: none;
        }
        .theme-toggle {
            position: absolute;
            top: 10px; /* Уменьшено для компактности */
            right: 10px; /* Позиция в правом углу */
            padding: 8px 12px; /* Компактные размеры */
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .theme-toggle:hover {
            background-color: var(--primary-hover);
        }
        .donate-top {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 8px 12px;
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
            font-weight: 600;
            text-decoration: none;
        }
        .donate-top:hover {
            background-color: var(--primary-hover);
            text-decoration: none;
        }
        /* Стили для копирования */
        .code-container {
            position: relative;
            margin: 20px 0;
            border-radius: 8px;
            overflow: hidden;
        }
        .copy-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: var(--container-bg);
            border: 1px solid var(--shadow);
            border-radius: 4px;
            padding: 5px;
            cursor: pointer;
            display: none;
            transition: background-color 0.3s;
        }
        .copy-btn:hover {
            background-color: var(--highlight-bg);
        }
        .code-container:hover .copy-btn {
            display: block;
        }
        .copy-icon {
            width: 16px;
            height: 16px;
            vertical-align: middle;
        }
        /* Медиа-запрос для мобильных устройств */
        @media (max-width: 576px) {
            .theme-toggle {
                padding: 6px 10px; /* Еще меньше для мобильных */
                font-size: 0.85em; /* Меньший текст */
            }
            .donate-top {
                padding: 6px 10px;
                font-size: 0.85em;
            }
        }
            /* Оверлей */
    .img-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.9);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }
    .img-overlay img {
        max-width: 95%;
        max-height: 95%;
        border-radius: 8px;
    }
    .img-overlay.close {
        cursor: pointer;
    }
    </style>
</head>
<body>
<div class="img-overlay" id="imgOverlay">
    <img src="" alt="Full Image">
</div>
    <script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script>
    <div class="container">
        <a href="https://yoomoney.ru/to/4100118816814288" class="donate-top" target="_blank">Донат</a>
        <button class="theme-toggle" onclick="toggleTheme()">Переключить тему</button>
        <h1>Magitrickle + SingBox Руководство</h1>
        <p class="highlight" style="text-align: center;">
            <a href="https://magitrickle.dev">MagiTrickle</a> | <a href="https://sing-box.sagernet.org/">SingBox</a>
        </p>

        <div class="section">
            <h2>Что потребуется</h2>
            <ul>
                <li>Роутер Keenetic с USB портом (или с прошивкой Keenetic), подключенный к интернету;</li>
                <li>USB накопитель (хватит 1 ГБ, USB Hub работает с USB модемами);</li>
                <li>Свободное время.</li>
            </ul>
            <p class="highlight"><strong>Протестировано на:</strong> Keenetic Giga KN-1011/KN-1012, Keenetic Viva KN-1913, Netis N6, Xiaomi MiRouter 3Gv1 (прошивка Keenetic).</p>
        </div>

        <div class="section">
            <h2>Настройка DoT и DoH вместо провайдерского DNS</h2>
            <p>Если уже настроено, пропустите этот пункт.</p>

            <h3>Вариант 1: Настройка через интерфейс роутера</h3>
            <p>Перейдите в: «Сетевые правила» > «Интернет фильтры» > «Настройка DNS»</p>
            <p>Добавьте серверы DNS-over-TLS:</p>
            <ul>
                <li>1.1.1.1 — <code>cloudflare-dns.com</code></li>
                <li>1.0.0.1 — <code>cloudflare-dns.com</code></li>
                <li>8.8.4.4 — <code>dns.google.com</code></li>
                <li>8.8.8.8 — <code>dns.google.com</code></li>
            </ul>
            <img src="media/image1.png" alt="Настройка DNS серверов">

            <h3>Вариант 2: Настройка через CLI</h3>
            <p>Перейдите по ссылке 192.168.1.1/a, или через «Шестеренку» > «Командная строка».</p>
            <p>Поочередно введите команды и нажмите "Отправить"</p>
            <pre>dns-proxy tls upstream 1.1.1.1 sni cloudflare-dns.com
dns-proxy tls upstream 1.0.0.1 sni cloudflare-dns.com
dns-proxy tls upstream 8.8.4.4 sni dns.google
dns-proxy tls upstream 8.8.8.8 sni dns.google
system configuration save</pre>
            <img src="media/image2.png" alt="Настройка DNS через CLI">
            <img src="media/image3.png" alt="Дополнительная настройка CLI">
            <p>В настройках интернет-соединения включите «Игнорировать DNSv4 интернет-провайдера» (и DNSv6, если используется IPv6).</p>
            <img src="media/image4.png" alt="Игнорирование DNS провайдера">
        </div>

        <div class="section">
            <h2>Установка Entware</h2>
            <h3>Подготовка флешки</h3>
            <p>Отформатируйте USB накопитель в ext4. Используйте утилиты, такие как <s>MiniTool Partition Wizard</s> (не рекомендуется) Paragon Partition Manager, так как Windows не поддерживает ext4 стандартными средствами.</p>
            <p><a href="https://help.keenetic.com">Ссылка на Keenetic Help</a></p>
            <img src="media/image5.png" alt="Форматирование флешки">

            <h3>Подготовка роутера</h3>
            <p>В общих настройках системы "Изменить набор компонентов", установите компонент «Поддержка открытых пакетов» (OPKG).</p>
            <img src="media/image6.png" alt="Установка компонента OPKG">

            <h3>Вариант установки 1: Через CLI</h3>
            <ol>
                <li>Зайдите в командную строку роутера: <a href="http://192.168.1.1/a">http://192.168.1.1/a</a> или через «Шестеренку» > «Командная строка».</li>
                <img src="media/image8.png" alt="Доступ к командной строке">
                <li>Введите: <code>opkg disk</code>, нажмите Tab, выберите имя флешки (как вы назвали ее при форматировании).</li>
                <img src="media/image9.png" alt="Выбор флешки в CLI">
                <li>Вставьте ссылку для вашей архитектуры:
                    <ul>
                        <li>mipsel: <a href="https://bin.entware.net/mipselsf-k3.4/installer/mipsel-installer.tar.gz">https://bin.entware.net/mipselsf-k3.4/installer/mipsel-installer.tar.gz</a></li>
                        <li>mips: <a href="https://bin.entware.net/mipssf-k3.4/installer/mips-installer.tar.gz">https://bin.entware.net/mipssf-k3.4/installer/mips-installer.tar.gz</a></li>
                        <li>aarch: <a href="https://bin.entware.net/aarch64-k3.10/installer/aarch64-installer.tar.gz">https://bin.entware.net/aarch64-k3.10/installer/aarch64-installer.tar.gz</a></li>
                    </ul>
                    <p class="highlight">
                    <b>Справка:</b> Для моделей 4G (KN-1212), Omni (KN-1410), Extra (KN-1710/1711/1713), Giga (KN-1010/1011), Ultra (KN-1810), Viva (KN-1910/1912/1913), Giant (KN-2610), Hero 4G (KN-2310/2311), Hopper (KN-3810) и Zyxel Keenetic II / III, Extra, Extra II, Giga II / III, Omni, Omni II, Viva, Ultra, Ultra II используйте для установки архив <b>mipsel</b><br>
                    Для моделей Ultra SE (KN-2510), Giga SE (KN-2410), DSL (KN-2010), Skipper DSL (KN-2112), Duo (KN-2110), Ultra SE (KN-2510),  Hopper DSL (KN-3610) и Zyxel Keenetic DSL, LTE, VOX используйте для установки архив <b>mips</b><br>
                    Для моделей Peak (KN-2710), Ultra (KN-1811), Giga (KN-1012), Hopper (KN-3811) и Hopper SE (KN-3812) используйте архив <b>aarch64</b>
                    </p>
                </li>
                <img src="media/image10.png" alt="Установка Entware через CLI">
                <li>Нажмите «Отправить запрос».</li>
                <li>Перейдите во вкладку «Диагностика», откройте журнал, дождитесь: <code>Opkg::Manager: /opt/etc/init.d/doinstall: [5/5] "Entware" installed!</code></li>
            </ol>

            <h3>Вариант установки 2: Через интерфейс</h3>
            <ol>
                <li>Скачайте инсталлятор Entware для вашего роутера (ссылки в варианте 1), например: <a href="https://bin.entware.net/mipselsf-k3.4/installer/mipsel-installer.tar.gz">mipsel-installer.tar.gz</a>.</li>
                <li>Вставьте флешку в роутер, зайдите в «Приложения», выберите флешку.</li>
                <img src="media/image11.png" alt="Выбор флешки в приложениях">
                <li>Создайте папку <code>install</code> в корне флешки, загрузите туда инсталлятор.</li>
                <img src="media/image12.png" alt="Создание папки install">
                <img src="media/image13.png" alt="Загрузка инсталлятора">
                <li>Перейдите во вкладку OPKG, выберите накопитель, нажмите «Сохранить».</li>
                <img src="media/image14.png" alt="Настройка OPKG">
                <li>Следите за установкой во вкладке «Диагностика». Ожидайте: <code>Opkg::Manager: /opt/etc/init.d/doinstall: [5/5] "Entware" installed!</code></li>
                <img src="media/image15.png" alt="Журнал установки">
            </ol>
        </div>

        <div class="section">
            <h2>Установка Magitrickle</h2>
            <p>Используйте SSH-клиент (PuTTY, Kitty, Termius). Подключитесь к роутеру:</p>
            <ul>
                <li>Адрес: IP роутера, порт: 222 (или 22, если «Сервер SSH» не установлен).</li>
                <li>Логин: <code>root</code>, пароль: <code>keenetic</code> (смените пароль командой <code>passwd</code>).</li>
            </ul>
            <img src="media/image16.png" alt="Подключение через SSH">
            <img src="media/image17.png" alt="Ввод логина и пароля">

            <p>Поочередно введите команды:</p>
            <pre>
wget -qO- http://bin.magitrickle.dev/packages/add_repo.sh | sh
opkg update && opkg install magitrickle
/opt/etc/init.d/S99magitrickle start</pre>
            <p>Для обновления пакета в дальнейшем можно использовать команду:</p>
            <pre>
opkg update && opkg install magitrickle
/opt/etc/init.d/S99magitrickle restart</pre>
            <p>Magitrickle запущен. Проверить можно через браузер: <code>адрес_роутера:8080</code></p>
            <img src="media/image19.png" alt="Интерфейс Magitrickle">
        </div>

        <div class="section">
            <h2>Установка Sing-Box</h2>
            <p>Установите Sing-Box:</p>
            <pre>
opkg install sing-box-go</pre>
            <img src="media/image20.png" alt="Установка Sing-Box">

            <h3>Создание конфига</h3>
            <p>Создать конфиг можно вручную, или использовать генераторы конфига:</p>
            <ul>
                <li><a href="https://kiarant.github.io/converter">Kiarant Converter</a></li>
                <li><a href="https://qp-io.github.io/keenetic-vless-singbox-tun-config-gen">QP-IO Config Generator</a></li>
            </ul>
            <p class="highlight"><strong>Примечание:</strong> 100% работоспособность конфига не гарантируется ввиду отсутствия возможности проверить все конфигурации.</p>
            <p>Загрузите конфиг в <code>/opt/etc/sing-box/</code> (замените стандартный). Я использовал WinSCP. Новое подлючение: адрес роутера, порт 222, логин <code>root</code>, пароль от entware (если не изменили: <code>keenetic</code>).</p>
            <img src="media/image21.png" alt="Загрузка конфига через WinSCP">
            <img src="media/image22.png" alt="Настройка WinSCP">

            <h3>Ручной способ создания конфига (by Ponywka)</h3>
            <ol>
                <li>Качаешь Nekobox</li>
                <li>Вставляешь свой конфиг в Nekobox</li>
                <li>ПКМ по конфигу -> Экспортировать конфиг Singbox</li>
                <li>Вставляешь конфиг на сайт <a href="https://jsonviewer.stack.hu/">https://jsonviewer.stack.hu/</a>.</li>
                <li>Сверху нажимаешь "Format"</li>
                <li>Спускаешься до <code>outbounds</code></li>
                <li>Копишуешь первый <code>outbounds</code> который является твоим сервером</li>
                <li>Открываешь /opt/etc/sing-box/config.json</li>
                <li>Стираешь всё там на*уй</li>
                <li>Заполняешь файл примером ниже </li>
                <li>Сохраняешь</li>
                <li><code>/opt/etc/init.d/S99sing-box start</code></li>
            </ol>
            <pre>
{
  "log": {
    "level": "info"
  },
  "inbounds": [
    {
      "type": "tun",
      "tag": "tun-in",
      "interface_name": "singtun0",
      "address": [
        "172.19.0.1/32"
      ],
      "stack": "gvisor"
    }
  ],
  "outbounds": [
    {
      "type": "selector",
      "tag": "select",
      "outbounds": [
        "auto",
        "proxy"
      ],
      "default": "auto",
      "interrupt_exist_connections": false
    },
    {
      "type": "urltest",
      "tag": "auto",
      "outbounds": [
        "proxy"
      ],
      "url": "https://www.gstatic.com/generate_204",
      "interval": "3m",
      "tolerance": 50,
      "idle_timeout": "30m",
      "interrupt_exist_connections": false
    },
    // СЮДА ВСТАВЛЯЕШЬ СВОЙ OUTBOUND!!!
    {
      "type": "block",
      "tag": "block"
    }
  ],
  "route": {
    "rules": [
      {
        "ip_version": 6,
        "outbound": "block"
      }
    ],
    "final": "select"
  },
  "experimental": {
    "clash_api": {
      "external_controller": "[::]:9090",
      "external_ui": "dashboard"
    }
  }
}</pre>
            <p>Проверьте конфиг:</p>
            <pre>sing-box check</pre>
            <img src="media/image23.png" alt="Проверка конфига Sing-Box">
            <p>Запустите Sing-Box:</p>
            <pre>/opt/etc/init.d/S99sing-box start</pre>
            <img src="media/image24.png" alt="Запуск Sing-Box">
            <p>Зайдите через браузер: <code>адрес_роутера:9090</code></p>
            <img src="media/image25.png" alt="Интерфейс Sing-Box">
            <p>Во вкладке Proxies можем увидеть подключения из конфига и выбрать то, которое будет использоваться для работы интерфейса <code>tun0</code> (если в конфиге использовался selector).</p>
            <img src="media/image26.png" alt="Выбор подключения в Proxies">
        </div>

        <div class="section">
            <h2>Настройка маршрутизации</h2>
            <p>Перейдите в интерфейс Magitrickle: <code>192.168.1.1:8080</code></p>
            <ol>
                <li>Нажмите «+», создайте группу.</li>
                <li>В выпадающем списке выбираем нужный нам интерфейс: <code>tun0</code> или <code>singtun0</code> (или как вы его обозвали).</li>
                <img src="media/image27.png" alt="Создание группы в Magitrickle">
                <li>Для проверки укажите в Pattern, например, <code>2ip.ru</code>, сохраните.</li>
                <img src="media/image28.png" alt="Настройка Pattern">
                <li>Откройте браузер в режиме инкогнито, зайдите на <a href="https://2ip.ru">2ip.ru</a>, проверьте.</li>
                <img src="media/image29.png" alt="Проверка на 2ip.ru">
            </ol>
            <p>Можете создавать разные группы с разными интерфейсами. Дальше ваша фантазия.</p>
            <p>Список доменов для разных сервисов можете найти по ссылке  <a href="https://iplist.opencck.org/ru">iplist.opencck.org</a> (формат «Text», тип «Домены», только wildcard).</p>
            <img src="media/image30.png" alt="Список доменов">
            <p>Для импорта больших списков можете использовать кнопку "Импортировать список"</p>
            <img src="media/image_mass_import.png" alt="Импорт списков">
            <img src="media/image_mass_import2.png" alt="Вставка списков">
            <img src="media/image_mass_import3.png" alt="Результат импорта списков">
            <p>Нажимаем "Сохранить изменения"</p>
            <img src="media/image_MT_save.png" alt="Сохранение изменений">
        </div>

        <div class="section">
            <h2>Типы правил маршрутизации</h2>
            <p>В интерфейсе Magitrickle доступны следующие типы правил:</p>
            <ul>
                <li><strong>Namespace (Именное пространство):</strong> Охватывает домен и поддомены. Например, <code>example.com</code>.</li>
                <img src="media/image31.png" alt="Namespace">
                <li><strong>Wildcard (Подстановочный шаблон):</strong> Использует <code>*</code> и <code>?</code>. Например, <code>*example.com</code>.</li>
                <img src="media/image32.png" alt="Wildcard">
                <li><strong>Domain (Точный домен):</strong> Только указанный домен, без поддоменов. Например, <code>sub.example.com</code>.</li>
                <img src="media/image33.png" alt="Domain">
                <li><strong>RegExp (Регулярное выражение):</strong> Для опытных пользователей, использует парсер <code>dlclark/regexp2</code>. Например, <code>^[a-z]*example\.com$</code>.</li>
                <img src="media/image34.png" alt="RegExp">
            </ul>
        </div>

        <div class="section">
            <h2>Поддержка автора</h2>
            <p> Поддержать автора можно по <a href="https://yoomoney.ru/to/4100118816814288" target="_blank">ссылке</a>
            <p style="text-align: center;"><a href="https://yoomoney.ru/to/4100118816814288" target="_blank" class="donate-button">Донат</a></p>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        function toggleTheme() {
            document.body.classList.toggle('dark');
            localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
        }

        // Load theme from localStorage
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark');
        }

        // Добавлено для копирования
        function wrapPreWithCopyButton() {
            const pres = document.querySelectorAll('pre');
            pres.forEach(pre => {
                // Проверяем, не обернут ли уже элемент
                if (!pre.parentElement.classList.contains('code-container')) {
                    const container = document.createElement('div');
                    container.className = 'code-container';
                    pre.parentElement.insertBefore(container, pre);
                    container.appendChild(pre);
                    const copyBtn = document.createElement('button');
                    copyBtn.className = 'copy-btn';
                    copyBtn.innerHTML = `
                        <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                    `;
                    copyBtn.onclick = () => copyCode(copyBtn);
                    container.appendChild(copyBtn);
                }
            });
        }

        function copyCode(button) {
            const pre = button.previousElementSibling;
            const text = pre.textContent;
            navigator.clipboard.writeText(text).then(() => {
                const originalContent = button.innerHTML;
                button.innerHTML = 'Скопировано!';
                setTimeout(() => {
                    button.innerHTML = originalContent;
                }, 2000);
            }).catch(err => {
                console.error('Ошибка копирования: ', err);
            });
        }

        // Вызываем функцию при загрузке страницы
        document.addEventListener('DOMContentLoaded', wrapPreWithCopyButton);
            document.addEventListener('DOMContentLoaded', () => {
        const overlay = document.getElementById('imgOverlay');
        const overlayImg = overlay.querySelector('img');

        document.querySelectorAll('img').forEach(img => {
            img.addEventListener('click', () => {
                overlay.style.display = 'flex';
                overlayImg.src = img.src;
            });
        });

        overlay.addEventListener('click', () => {
            overlay.style.display = 'none';
            overlayImg.src = '';
        });
    });
        // Конец добавленного кода

    </script>
</body>
</html>
